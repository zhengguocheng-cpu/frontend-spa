# 登录功能测试指南

## 🚀 启动应用

### 1. 启动开发服务器
```bash
cd e:/windsurf_prj/doudizhu/frontend-spa
npm run dev
```

### 2. 查找端口
开发服务器会自动寻找可用端口：
- 默认尝试：`5173`
- 如果被占用，会尝试：`5174`, `5175`, `5176` 等

**查看终端输出**，找到类似这样的信息：
```
  ➜  Local:   http://localhost:5175/
  ➜  Network: use --host to expose
```

---

## 🧪 测试步骤

### 测试 1: 访问登录页面

1. **打开浏览器**
   - Chrome（推荐）
   - Edge
   - Firefox

2. **访问登录页面**
   ```
   http://localhost:5175/login
   ```
   （将 5175 替换为实际端口）

3. **预期结果**
   - ✅ 页面正常加载
   - ✅ 显示"🎮 斗地主"标题
   - ✅ 有输入框和头像选择器
   - ✅ 无控制台错误

4. **如果出现错误**
   - 打开浏览器控制台（F12）
   - 查看 Console 标签
   - 截图错误信息

---

### 测试 2: 输入用户信息

1. **输入用户名**
   - 点击"玩家昵称"输入框
   - 输入：`测试玩家`

2. **选择头像**
   - 点击"选择头像"区域
   - 从底部弹出的选择器中选择一个头像
   - 例如：🐯 或 🐼

3. **预期结果**
   - ✅ 输入框正常工作
   - ✅ 头像选择器弹出
   - ✅ 选择后头像显示更新
   - ✅ 无错误提示

---

### 测试 3: 提交登录

1. **点击"进入游戏大厅"按钮**

2. **观察过程**
   - 按钮显示 loading 状态
   - 顶部显示 Toast 提示

3. **预期结果**
   - ✅ 显示"登录成功，正在进入大厅"
   - ✅ 自动跳转到 `/rooms` 页面
   - ⚠️ **注意**：`/rooms` 页面会报错（这是已知问题）

4. **检查 Socket 连接**
   - 打开浏览器 DevTools（F12）
   - 切换到 **Network** 标签
   - 点击 **WS**（WebSocket）过滤器
   - 查看 WebSocket 连接

5. **预期结果**
   - ✅ 只有 **1 个** WebSocket 连接
   - ✅ 连接状态为 `connected`
   - ✅ 可以看到 Socket.IO 握手信息

---

### 测试 4: 检查本地存储

1. **打开 DevTools**
2. **切换到 Application 标签**
3. **查看 Local Storage**
   - 展开 `http://localhost:5175`
   - 查看存储的数据

4. **预期结果**
   ```
   userId: "测试玩家"
   userName: "测试玩家"
   playerAvatar: "🐯"
   ```

---

### 测试 5: 刷新页面（状态恢复）

1. **在登录后的页面按 F5 刷新**

2. **预期结果**
   - ✅ 不会跳回登录页
   - ✅ 保持登录状态
   - ✅ Socket 自动重连
   - ⚠️ 页面可能报错（因为 RoomList 未修复）

---

## 🐛 已知问题

### 问题 1: 登录后页面报错
**现象**：
- 登录成功
- 跳转到 `/rooms`
- 页面显示错误或白屏

**原因**：
- RoomList 页面仍在使用 `antd`（桌面版）
- 组件不兼容

**解决方案**：
- 这是预期行为
- 需要修复 RoomList 页面
- 不影响登录功能测试

### 问题 2: 端口被占用
**现象**：
```
Port 5173 is in use, trying another one..
```

**解决方案**：
- Vite 会自动尝试其他端口
- 查看终端输出，使用实际端口

---

## ✅ 测试检查清单

### 核心功能
- [ ] 登录页面正常加载
- [ ] 输入框正常工作
- [ ] 头像选择器正常工作
- [ ] 登录按钮正常工作
- [ ] Toast 提示正常显示
- [ ] 页面跳转正常

### Socket 连接
- [ ] 只有 1 个 WebSocket 连接
- [ ] 连接状态为 connected
- [ ] 可以看到认证成功消息

### 状态管理
- [ ] 用户信息保存到 localStorage
- [ ] 刷新页面状态保持
- [ ] AuthContext 正常工作

### 无限循环修复验证
- [ ] 无 "Maximum update depth exceeded" 错误
- [ ] 页面不会卡死
- [ ] 控制台无大量重复日志
- [ ] React DevTools 显示组件更新正常

---

## 📸 测试截图

### 成功案例

**1. 登录页面**
- 干净的 UI
- 无错误信息
- 输入框和按钮正常

**2. Socket 连接**
```
Network → WS 标签
✅ socket.io/?EIO=4&transport=websocket
Status: 101 Switching Protocols
```

**3. 控制台日志**
```
✅ Socket连接成功: { socketId: "...", userId: "...", userName: "..." }
✅ 登录成功，正在进入大厅
```

### 失败案例（如果出现）

**控制台错误示例**：
```
❌ Maximum update depth exceeded
❌ Cannot read properties of undefined
❌ Failed to fetch
```

---

## 🔍 调试技巧

### 1. 查看详细日志
打开浏览器控制台，查看：
- Socket 连接日志（带 🔔 emoji）
- 认证日志（带 ✅ emoji）
- 错误日志（带 ❌ emoji）

### 2. 使用 React DevTools
安装 React DevTools 扩展：
- 查看组件树
- 检查 AuthContext 的值
- 监控组件重渲染

### 3. 使用 Redux DevTools
安装 Redux DevTools 扩展：
- 查看 Redux state
- 监控 action 派发
- 时间旅行调试

---

## 📊 测试报告模板

```markdown
## 登录功能测试报告

**测试时间**：2025-11-03 05:10 AM
**测试人员**：[你的名字]
**浏览器**：Chrome 120
**端口**：5175

### 测试结果

| 测试项 | 状态 | 说明 |
|--------|------|------|
| 页面加载 | ✅/❌ | |
| 输入功能 | ✅/❌ | |
| 头像选择 | ✅/❌ | |
| 登录提交 | ✅/❌ | |
| Socket 连接 | ✅/❌ | |
| 状态保存 | ✅/❌ | |
| 无限循环修复 | ✅/❌ | |

### 发现的问题

1. [问题描述]
   - 现象：
   - 错误信息：
   - 截图：

### 总体评价

- [ ] 通过
- [ ] 部分通过
- [ ] 失败

### 备注

[其他说明]
```

---

## 🎯 下一步

### 如果测试通过 ✅
1. 登录功能正常工作
2. Socket 单连接正确实现
3. 无限循环问题已解决
4. **可以开始修复 RoomList 页面**

### 如果测试失败 ❌
1. 记录错误信息
2. 截图控制台
3. 提供详细描述
4. 我会帮你修复

---

## 💡 提示

### 移动端测试
如果想测试移动端效果：
1. 按 F12 打开 DevTools
2. 点击设备工具栏图标（Ctrl+Shift+M）
3. 选择设备：iPhone 14 Pro
4. 刷新页面

### 网络测试
如果想测试断线重连：
1. 打开 DevTools → Network
2. 选择 "Offline" 模式
3. 等待 5 秒
4. 切换回 "Online"
5. 观察 Socket 是否自动重连

---

准备好了吗？开始测试吧！🚀
